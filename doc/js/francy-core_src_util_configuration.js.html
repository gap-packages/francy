<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: francy-core/src/util/configuration.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: francy-core/src/util/configuration.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Observable from './observable';
import {Utilities} from './utilities';

/**
 * This class provides the application configuration.
 * It extends the {Observable} class providing methods to subscribe on changes.
 *
 * @extends {Observable}
 */
export default class ConfigurationHandler extends Observable {
  /**
   * Creates an instance of ModelTracker.
   *
   * @param {object} object - the object to keep track of changes.
   * @param {object} config
   * @param {number} config.throttle - the interval for storing dirty data
   */
  constructor(object, {throttle = 5000, backend = BACKEND.NONE} = {}) {
    super();
    /**
     * This is property is used to flag when the object changes.
     * @type {boolean}
     * @private
     */
    this._localDirty = false;
    /**
     * This is property is used to flag when the object changes in the store.
     * @type {boolean}
     * @private
     */
    this._storageDirty = false;
    /**
     * The interval time to check and store changes
     * @private
     */
    this._throttle = throttle;
    /**
     * The backend to be used
     * @private
     */
    this._backend = backend;
    // load configuration object
    this._load(object);
  }

  /**
   * This loads the configuration object
   * @type function
   * @private
   */
  _load(object) {
    if (this._backend) {
      let objectStored = this._backend.getItem(SETTINGS_KEY);
      if (!objectStored) {
        this._localDirty = true;
      } else {
        object = Object.assign(object, JSON.parse(objectStored));
      }
      /**
       * Sync listeners every second, if data is dirty
       * @type {setInterval}
       * @private
       */
      setInterval(() => {
        this._syncPull();
        this._syncPush();
      }, this._throttle);
    }
    /**
     * This is property holds a proxy that handles a dirty flag when object changes.
     * @type {Proxy}
     * @private
     */
    this._proxy = new Proxy(object, this);
  }

  /**
   * This method is used by the proxy to set a property when a change occurs, plus it sets the current object to dirty.
   * @param {object} object - the object being tracked
   * @param {string} property - the property changed
   * @param {object} value - the new value
   * @public
   */
  set(object, property, value) {
    if (object[property] !== value) {
      object[property] = value;
      this.notify(property, value);
      this._localDirty = true;
    }
    return true;
  }

  /**
   * This method is used by the proxy to get the object being tracked
   * @param {object} target - the object being tracked
   * @param {object} property - the object property
   * @returns {object} returns the object being tracked
   * @public
   */
  get(target, property) {
    if (typeof target[property] === 'object' &amp;&amp; target[property] !== null) {
      return new Proxy(target[property], this);
    }
    return property in target ? target[property] : target;
  }

  /**
   * This method is used by the proxy to check if the object has a property
   * @param {object} target - the object being tracked
   * @param {object} key - the object property
   * @returns {boolean} returns true if the property exists, otherwise false
   * @public
   */
  has(target, key) {
    if (key[0] === '_') {
      return false;
    }
    return key in target;
  }

  /**
   * Returns the object being tracked (proxy)
   * @returns {object} the object properties
   * @public
   */
  get object() {
    return this._proxy;
  }

  /**
   * Adds a new configuration property
   *
   * @param {string} property - the configuration property name
   * @param {object} value - the configuration property value
   * @returns {object} this instance
   * @public
   */
  addProperty(property, value) {
    if (!this.hasProperty(property)) {
      Object.defineProperty(this.object, property, {
        value: value,
        writable: true,
        enumerable: true,
        configurable: true
      });
      this._localDirty = true;
    }
    return this;
  }

  /**
   * Checks if a configuration property exists. Returns true if it exists, otherwise false.
   *
   * @param {string} name - the configuration property name
   * @returns {boolean} returns true if the property exists, otherwise false
   * @public
   */
  hasProperty(name) {
    return name in this.object;
  }

  /**
   * This method is used to explicitly sync the module with all the subscribers
   * @private
   */
  _syncPush() {
    if (this._localDirty &amp;&amp; !this._storageDirty) {
      this._backend.setItem(SETTINGS_KEY, JSON.stringify(this.object));
    }
  }

  /**
   * This method is used to explicitly sync the current object from the storage
   * @private
   */
  _syncPull() {
    if (!this._localDirty) {
      // check for changes and load them
      let item = this._backend.getItem(SETTINGS_KEY);
      if (item) {
        let obj = Object.assign({}, JSON.parse(item));
        let diffs = Utilities.getDifferences(obj, this.object);
        if (diffs.length > 0) {
          this._storageDirty = true;
          diffs.forEach((key) => {
            this.object[key] = obj[key];
          });
          this._localDirty = false;
          this._storageDirty = false;
        }
      }
    }
  }
}

/**
 * Settings key to be stored in the local/session storage
 * @private
 */
const SETTINGS_KEY = 'francy.settings';

/**
 * The minimal default {Configuration} object singleton
 * @public
 */
export const DefaultConfiguration = {
  showNeighbours: true,
  dragNodes: true,
  simulation: true
};

/**
 * The list of backends supported
 * @public
 */
export const BACKEND = {
  SESSION: window.sessionStorage,
  LOCAL: window.localStorage,
  NONE: undefined
};

/**
 * The global {Configuration} singleton
 * @public
 */
export const GlobalConfiguration = new ConfigurationHandler({
  verbose: false,
  transitionDuration: 750, //ms
  fixedRandomSeed: true,
}, {
  throttle: 5000,
  backend: BACKEND.LOCAL
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Exception.html">Exception</a></li><li><a href="FrancyApp.html">FrancyApp</a></li><li><a href="FrancyWidget.html">FrancyWidget</a></li><li><a href="Log.html">Log</a></li><li><a href="RuntimeException.html">RuntimeException</a></li><li><a href="module.exports.html">exports</a></li></ul><h3>Global</h3><ul><li><a href="global.html#BACKEND">BACKEND</a></li><li><a href="global.html#DefaultConfiguration">DefaultConfiguration</a></li><li><a href="global.html#GlobalConfiguration">GlobalConfiguration</a></li><li><a href="global.html#HTMLCanvasParent">HTMLCanvasParent</a></li><li><a href="global.html#HTMLParent">HTMLParent</a></li><li><a href="global.html#Logger">Logger</a></li><li><a href="global.html#MIME">MIME</a></li><li><a href="global.html#RENDERING_EVENTS">RENDERING_EVENTS</a></li><li><a href="global.html#SVGParent">SVGParent</a></li><li><a href="global.html#activeRenderer">activeRenderer</a></li><li><a href="global.html#addChild">addChild</a></li><li><a href="global.html#addProperty">addProperty</a></li><li><a href="global.html#allRenderers">allRenderers</a></li><li><a href="global.html#autoUnrender">autoUnrender</a></li><li><a href="global.html#enable">enable</a></li><li><a href="global.html#enabled">enabled</a></li><li><a href="global.html#execute">execute</a></li><li><a href="global.html#extension">extension</a></li><li><a href="global.html#get">get</a></li><li><a href="global.html#getMousePosition">getMousePosition</a></li><li><a href="global.html#handle">handle</a></li><li><a href="global.html#handleErrors">handleErrors</a></li><li><a href="global.html#handlePromise">handlePromise</a></li><li><a href="global.html#has">has</a></li><li><a href="global.html#hasProperty">hasProperty</a></li><li><a href="global.html#height">height</a></li><li><a href="global.html#hide">hide</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#isAvailable">isAvailable</a></li><li><a href="global.html#iterator">iterator</a></li><li><a href="global.html#load">load</a></li><li><a href="global.html#margin">margin</a></li><li><a href="global.html#mathTypesetting">mathTypesetting</a></li><li><a href="global.html#notEmpty">notEmpty</a></li><li><a href="global.html#notify">notify</a></li><li><a href="global.html#object">object</a></li><li><a href="global.html#onErrorExec">onErrorExec</a></li><li><a href="global.html#onErrorThrow">onErrorThrow</a></li><li><a href="global.html#parent">parent</a></li><li><a href="global.html#parentClass">parentClass</a></li><li><a href="global.html#parse">parse</a></li><li><a href="global.html#register">register</a></li><li><a href="global.html#removeChildren">removeChildren</a></li><li><a href="global.html#render">render</a></li><li><a href="global.html#renderChildren">renderChildren</a></li><li><a href="global.html#requires">requires</a></li><li><a href="global.html#set">set</a></li><li><a href="global.html#settings">settings</a></li><li><a href="global.html#show">show</a></li><li><a href="global.html#subscribe">subscribe</a></li><li><a href="global.html#syntax">syntax</a></li><li><a href="global.html#traverse">traverse</a></li><li><a href="global.html#unregister">unregister</a></li><li><a href="global.html#unregisterAllExcept">unregisterAllExcept</a></li><li><a href="global.html#unrender">unrender</a></li><li><a href="global.html#unsubscribe">unsubscribe</a></li><li><a href="global.html#unsubscribeAll">unsubscribeAll</a></li><li><a href="global.html#width">width</a></li><li><a href="global.html#withContext">withContext</a></li><li><a href="global.html#withLogRetries">withLogRetries</a></li><li><a href="global.html#withRetries">withRetries</a></li><li><a href="global.html#withStackTrace">withStackTrace</a></li><li><a href="global.html#wrap">wrap</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Tue Feb 21 2023 22:00:55 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
