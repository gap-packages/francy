<html>

<head>
  <meta charset="utf-8" content="text/html" property="GAP,francy,d3.v4">
  <link rel="stylesheet" type="text/css" href="../../dist/style/index.css">
  <script src="../../node_modules/d3/dist/d3.min.js"></script>
  <script src="../../dist/browser/francy.bundle.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML-full,Safe"></script>
  <title>Francy Test</title>
</head>

<body>
  <div id="francy_draw" style="visibility:hidden;"></div>
  <script>
    /* global d3 Francy */

    function trigger(json) {
      console.log(`Trigger(${JSON.stringify(JSON.stringify(json))});`);
    }

    function resolvePromise(francy) {
      francy.render().catch(error => console.log(error)).then(element => {
        // NOTE: we're using a visible div to append the object so no need to do anything here
        //document.getElementsByTagName('body')[0].appendChild(element);
        if (element) {
          document.getElementsByTagName('body')[0].appendChild(element);
          console.log('Object rendered...', element);
        }
      });
    }

    let settings = { verbose: true, appendTo: '#francy_draw', callbackHandler: trigger };
    const francy = new Francy(settings);

    d3.json('json1.json').then(json => {
      resolvePromise(francy.load(json));
      setInterval(() => {
        d3.json('json1.1.json').then(json => {
          resolvePromise(francy.load(json));
        });
      }, 10000);
    });

    d3.json('json2.json').then(json => {
      resolvePromise(francy.load(json));
      setInterval(() => {
        d3.json('json2.1.json').then(json => {
          resolvePromise(francy.load(json));
        });
      }, 10000);
    });

    d3.json('json3.json').then(json => {
      resolvePromise(francy.load(json));
    });

    d3.json('json4.json').then(json => {
      resolvePromise(francy.load(json));
    });

    d3.json('json5.json').then(json => {
      resolvePromise(francy.load(json));
    });

    d3.json('json6.json').then(json => {
      resolvePromise(francy.load(json));
    });

    d3.json('json7.json').then(json => {
      resolvePromise(francy.load(json));
    });

    d3.json('json8.json').then(json => {
      resolvePromise(francy.load(json));
    });

    d3.json('json9.json').then(json => {
      resolvePromise(francy.load(json));
    });

    d3.json('json10.json').then(json => {
      resolvePromise(francy.load(json));
    });

    d3.json('json11.json').then(json => {
      resolvePromise(francy.load(json));
      setTimeout(() => {
        d3.json('json11.1.json').then(json => {
          resolvePromise(francy.load(json));
          setInterval(() => {
            d3.json('json11.2.json').then(json => {
              resolvePromise(francy.load(json));
            });
          }, 10000);
        });
      }, 5000);
    });

    d3.json('json12.json').then(json => {
      resolvePromise(francy.load(json));
    });
  </script>
</body>

</html>
